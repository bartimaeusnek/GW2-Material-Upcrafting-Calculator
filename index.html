<html>
    <head>
        <title>T5 Upcrafting</title>
        <style>
            .verlust {
              color: white;
              background-color: maroon;
              border-color: black;
            }
            .gewinn {
                color: white;
                background-color: green;
                border-color: black;
            }
            table, th, td {
                border: 1px solid;
                border-color: black;
            }
            table {
                border-collapse: collapse;
            }
        </style>
    </head>
    <body>
        <div>
            <h2>Gewinn Upcrafting T5 Materials</h2>
            <div>
                <table class="table">
                  <thead>
                  <tr>
                    <th>Material</th>
                    <th>Preis T6</th>
                    <th>Preis T5</th>
                    <th>Preis Staub</th>
                    <th>Gewinn</th>
                  </tr>
                  </thead>
                  <tbody id="tbl">
                      <!--JS injects here-->
                  </tbody>
                </table> 
            </div>
        </div>
    </body>
    <script>
        let staubID = "24277";

        function httpGet(theUrl)
        {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", theUrl, false );
            xmlHttp.send( null );
            return xmlHttp.responseText;
        }
        function getPriceForItem(itemID)
        {
           return JSON.parse(httpGet("https://api.guildwars2.com/v2/commerce/prices/"+itemID)).sells.unit_price
        }
        function getNameForItem(itemID)
        {
           return JSON.parse(httpGet("https://api.guildwars2.com/v2/items/"+itemID)).name
        }

        let preisStaub = getPriceForItem(staubID)
        let z5 = 5 * preisStaub;

        function createTableCell(tr, text){
            let tbMat = document.createElement('td');
            tbMat.innerText = text;
            tr.appendChild(tbMat);
            return tbMat;
        }

        function createTableEntry(itemIDT6, itemIDT5)
        {
            let preisT6 = getPriceForItem(itemIDT6);
            let preisT5 = getPriceForItem(itemIDT5);
            let name = getNameForItem(itemIDT6);
            let tr = document.createElement('tr');

            createTableCell(tr, name);
            createTableCell(tr, preisT6);
            createTableCell(tr, preisT5);
            createTableCell(tr, preisStaub);

            let x6 = 6 * preisT6;
            let y50 = 50 * preisT5;
            let gewinn = x6-y50-z5;
            let tgewinn = createTableCell(tr, gewinn);
            if (gewinn >= 0)
            {
                tgewinn.parentNode.classList.add("gewinn")
            }
            else
            {
                tgewinn.parentNode.classList.add("verlust")
            }

            tbl.appendChild(tr);
        }
        
        //Knochen
        createTableEntry("24358","24341");  
        //Klaue
        createTableEntry("24351","24350");
        //Fangzahn
        createTableEntry("24357","24356");
        //Scale
        createTableEntry("24289","24288");
        //Totem
        createTableEntry("24300","24299");
        //Venom Sac
        createTableEntry("24283","24282");
        //Blood
        createTableEntry("24295","24294");


        let staubpreisT5 = getPriceForItem("24276");
        let staubname = getNameForItem(staubID);
        let staubtr = document.createElement('tr');

        createTableCell(staubtr, staubname);
        createTableCell(staubtr, preisStaub);
        createTableCell(staubtr, staubpreisT5);
        createTableCell(staubtr, preisStaub);

        let staubgewinn = 5 * preisStaub - 250 * staubpreisT5;
        let staubtgewinn = createTableCell(staubtr, staubgewinn);

        if (staubgewinn >= 0)
        {
            staubtgewinn.parentNode.classList.add("gewinn")
        }
        else
        {
            staubtgewinn.parentNode.classList.add("verlust")
        }

        tbl.appendChild(staubtr);
    </script>
</html>
